---
layout: post
title: '无状态端口扫描器masscan简单使用'
subtitle: '30分钟扫遍全网IPV4'
date: 2017-12-11-15:29:12
categories: [工具]
cover: 'https://upload-images.jianshu.io/upload_images/2348227-f39ea4c7c14d49ca.jpg'
tags: [masscan,端口扫描工具]
---

*听说标题要长才会有人看*

masscan是当前最快的无状态端口扫描器，代码质量和速度也比zmap要高，github上的star数量zmap是2064，而masscan是6878，而且关键的是masscan可以在windows下运行，zmap则做不到，其实如果不是对大范围ip或者域名扫描，根本用不到masscan，nmap就可以搞定了，但是如果你面临短时间内主机存活探测，内网探测问题时，masscan就是一个利器。加个upx的壳后只有100k，而且目前2017年10月7日13:08:17，是完全免杀的，https://www.virustotal.com上面没有一个报毒。因此有的小马就会自带一个masscan，释放后执行内网扫描，溜的一批~~~，freebuf上面就有这样的分析文章。

废话不多说，需要windows下扫描文件的请私信，小小的100k文件蕴含着巨大的能量。

这里简单说一下IP地址划分的时候，关于私有地址是这样定的：
A类地址：10.0.0.0--10.255.255.255
B类地址：172.16.0.0--172.31.255.255
C类地址：192.168.0.0--192.168.255.255

至于自己所在的网段是哪一类地址，这个就是一条命令的事。
**但是当前在学校或者企业中普遍存在这么一种情况，ISP分配的是A类地址或者B类地址，这个时候不要看到这么多可以用的ip就非常高兴，因为这种情况有90%的可能性是ISP为了节省成本，把很多企业都分配到了一个A段地址，也就是说使用A段地址的不仅仅有你们，还有其他单位。这样网络的安全性会进一步降低，大家都是一个局域网嘛，搞不定你，我可以搞别人**

使用masscan前提是安装winpcap，和安装nmap时带的npcap有冲突，如果已经安装了nmap，安装winpcap时直接覆盖安装就ok

masscan常用命令：
* 扫描C段开放3389的主机，发包速率1500，结果保存到192.168.0.0-192.168.255.255.txt中
```masscan.exe 192.168.0.0-192.168.255.255 -Pn -sS -n -p 3389 --rate 1500 >> 192.168.0.0-192.168.255.255.txt```
* 扫描C段开放80，81，3389的主机，发包速率1500，结果以列表的形式保存到192.168.0.0-192.168.255.255.txt中
```masscan.exe 192.168.0.0-192.168.255.255 -Pn -sS -n -p 80-81,3389 --rate 1500 -oL 192.168.0.0-192.168.255.255.txt```
* 保存配置文件为config.conf：扫描C段开放80，81，3389的主机，发包速率1500，结果以列表的形式保存到192.168.0.0-192.168.255.255.txt中(并不会执行扫描，只是把扫描配置保存为文件)
```masscan.exe 192.168.0.0-192.168.255.255 -Pn -sS -n -p 80-81,3389 --rate 1500 -oL 192.168.0.0-192.168.255.255.txt --echo > config.conf```
* 执行当前目录下配置文件config.conf中的扫描，重新设置发包速率为1000
```masscan -c config.conf --rate 1000```

基本就是这些常用命令，其它的有```masscan --help   masscan --nmap```，如果有其它特殊需求，去github去找就行，主页在这[github-masscan](https://github.com/robertdavidgraham/masscan)，虽然是英文说明，但是还是很容易看明白。

建议有时间的读源代码。